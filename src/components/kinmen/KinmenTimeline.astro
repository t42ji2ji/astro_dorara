---
import InteractiveContainer from '../InteractiveContainer.astro'

interface TimelineEvent {
  year: string
  title: string
  description: string
  category: 'war' | 'politics' | 'culture' | 'transport' | 'ecology' | 'industry'
  icon: string
}

const events: TimelineEvent[] = [
  {
    year: '1842',
    title: 'å»ˆé–€é–‹æ¸¯',
    description: 'é‡‘é–€äººé–‹å§‹ã€Œè½ç•ªã€å—æ´‹è¬€ç”Ÿï¼Œé–‹å•Ÿæµ·å¤–ç§»æ°‘æ½®',
    category: 'culture',
    icon: 'â›µ'
  },
  {
    year: '1921',
    title: 'é™³æ™¯è˜­æ´‹æ¨“è½æˆ',
    description: 'é‡‘é–€è¦æ¨¡æœ€å¤§çš„æ´‹æ¨“ï¼Œè¦‹è­‰å—æ´‹åƒ‘æ°‘è¡£éŒ¦é‚„é„‰',
    category: 'culture',
    icon: 'ğŸ›ï¸'
  },
  {
    year: '1949',
    title: 'å¤å¯§é ­æˆ°å½¹',
    description: 'åœ‹å…±å…§æˆ°é—œéµæˆ°å½¹ï¼Œå…±è»ç™»å³¶å¾Œå…¨è»è¦†æ²’',
    category: 'war',
    icon: 'âš”ï¸'
  },
  {
    year: '1952',
    title: 'é‡‘é–€é…’å» å‰µç«‹',
    description: 'èƒ¡ç’‰å°‡è»ç‚ºè§£æ±ºè²¡æ”¿å•é¡Œå‰µè¾¦ï¼Œç¾å¹´ç‡Ÿæ”¶130å„„',
    category: 'industry',
    icon: 'ğŸ¥ƒ'
  },
  {
    year: '1958',
    title: 'å…«äºŒä¸‰ç ²æˆ°',
    description: '44å¤©å…§è½å½ˆ47è¬ç™¼ï¼Œæ”¹è®Šé‡‘é–€åœ°æ™¯çš„æ¿€çƒˆç ²æ“Š',
    category: 'war',
    icon: 'ğŸ’¥'
  },
  {
    year: '1958-79',
    title: 'å–®æ‰“é›™ä¸æ‰“',
    description: 'æŒçºŒ20å¹´çš„é¨·æ“¾å¼ç ²æ“Šï¼Œå–®æ—¥æ‰“ã€é›™æ—¥åœ',
    category: 'war',
    icon: 'ğŸ“…'
  },
  {
    year: '1992',
    title: 'è§£é™¤æˆ°åœ°æ”¿å‹™',
    description: 'çµæŸè»æ”¿ä¸€å…ƒçµ±æ²»ï¼Œé‡‘é–€çµ‚æ–¼ã€Œè§£åš´ã€',
    category: 'politics',
    icon: 'ğŸ•Šï¸'
  },
  {
    year: '1999',
    title: 'ä¸¹æ©é¢±é¢¨',
    description: '14éš»å­”é›€å¾ç•œè©¦æ‰€é€ƒè„«ï¼Œå¤–ä¾†ç¨®å±æ©Ÿçš„é–‹å§‹',
    category: 'ecology',
    icon: 'ğŸ¦š'
  },
  {
    year: '2001',
    title: 'å°ä¸‰é€šå•Ÿèˆª',
    description: 'é‡‘é–€åˆ°å»ˆé–€20åˆ†é˜ï¼Œå…©å²¸äº¤æµæ–°ç´€å…ƒ',
    category: 'transport',
    icon: 'â›´ï¸'
  },
  {
    year: '2022',
    title: 'é‡‘é–€å¤§æ©‹é€šè»Š',
    description: 'é€£çµå¤§å°é‡‘é–€ï¼Œå…¨é•·5.4å…¬é‡Œçš„è·¨æµ·å¤§æ©‹',
    category: 'transport',
    icon: 'ğŸŒ‰'
  },
  {
    year: '2024',
    title: 'å­”é›€ç ´2400éš»',
    description: 'ç¹æ®–å¤±æ§ï¼Œæ”¿åºœæ‡¸è³600å…ƒï¼Œé¤å»³æ¨å­”é›€æ–™ç†',
    category: 'ecology',
    icon: 'ğŸ¦š'
  }
]

const categoryColors = {
  war: 'bg-red-500',
  politics: 'bg-purple-500',
  culture: 'bg-amber-500',
  transport: 'bg-blue-500',
  ecology: 'bg-green-500',
  industry: 'bg-orange-500'
}

const categoryLabels = {
  war: 'æˆ°çˆ­',
  politics: 'æ”¿æ²»',
  culture: 'æ–‡åŒ–',
  transport: 'äº¤é€š',
  ecology: 'ç”Ÿæ…‹',
  industry: 'ç”¢æ¥­'
}
---

<InteractiveContainer
  title="é‡‘é–€æ­·å²æ™‚é–“è»¸"
  description="å¾è½ç•ªå—æ´‹åˆ°å°ä¸‰é€šï¼Œä¸€åº§å³¶å¶¼çš„ç™¾å¹´è®Šé·"
>
  <!-- Category Filter -->
  <div class="flex flex-wrap gap-2 mb-6">
    <button class="filter-btn active px-3 py-1 text-xs rounded-full bg-stone-200 dark:bg-stone-700 text-stone-700 dark:text-stone-200 transition-all" data-filter="all">
      å…¨éƒ¨
    </button>
    {Object.entries(categoryLabels).map(([key, label]) => (
      <button
        class={`filter-btn px-3 py-1 text-xs rounded-full bg-stone-100 dark:bg-stone-800 text-stone-500 dark:text-stone-400 hover:text-white transition-all hover:${categoryColors[key as keyof typeof categoryColors]}`}
        data-filter={key}
      >
        {label}
      </button>
    ))}
  </div>

  <!-- Timeline -->
  <div class="relative" id="timeline-container">
    <!-- Vertical line -->
    <div class="absolute left-4 md:left-1/2 top-0 bottom-0 w-0.5 bg-stone-200 dark:bg-stone-700 transform md:-translate-x-1/2"></div>

    <!-- Events -->
    <div class="space-y-8">
      {events.map((event, index) => (
        <div
          class={`timeline-event relative flex flex-col md:flex-row ${index % 2 === 0 ? 'md:flex-row-reverse' : ''} items-start md:items-center gap-4 opacity-0 translate-y-4`}
          data-category={event.category}
          data-index={index}
          style={`animation-delay: ${index * 100}ms`}
        >
          <!-- Year badge (center on desktop) -->
          <div class="absolute left-0 md:left-1/2 transform md:-translate-x-1/2 z-10">
            <div class={`w-8 h-8 rounded-full ${categoryColors[event.category]} flex items-center justify-center text-white text-sm shadow-lg`}>
              {event.icon}
            </div>
          </div>

          <!-- Content card -->
          <div class={`ml-12 md:ml-0 md:w-[calc(50%-2rem)] ${index % 2 === 0 ? 'md:mr-auto md:pr-8' : 'md:ml-auto md:pl-8'}`}>
            <div class="event-card bg-white dark:bg-stone-800 rounded-lg p-4 shadow-md border border-stone-100 dark:border-stone-700 hover:shadow-lg transition-all cursor-pointer group">
              <div class="flex items-center gap-2 mb-2">
                <span class={`text-xs px-2 py-0.5 rounded ${categoryColors[event.category]} text-white`}>
                  {event.year}
                </span>
                <span class={`text-xs px-2 py-0.5 rounded bg-stone-100 dark:bg-stone-700 text-stone-500 dark:text-stone-400`}>
                  {categoryLabels[event.category]}
                </span>
              </div>
              <h4 class="font-bold text-stone-800 dark:text-stone-100 mb-1 group-hover:text-primary transition-colors">
                {event.title}
              </h4>
              <p class="text-sm text-stone-600 dark:text-stone-400 leading-relaxed">
                {event.description}
              </p>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</InteractiveContainer>

<script>
  // Intersection Observer for scroll animations
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-in')
          entry.target.classList.remove('opacity-0', 'translate-y-4')
        }
      })
    },
    { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
  )

  document.querySelectorAll('.timeline-event').forEach((el) => {
    observer.observe(el)
  })

  // Filter functionality
  const filterBtns = document.querySelectorAll('.filter-btn')
  const events = document.querySelectorAll('.timeline-event')

  filterBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter')

      // Update active state
      filterBtns.forEach((b) => {
        b.classList.remove('active', 'bg-stone-200', 'dark:bg-stone-700', 'text-stone-700', 'dark:text-stone-200')
        b.classList.add('bg-stone-100', 'dark:bg-stone-800', 'text-stone-500', 'dark:text-stone-400')
      })
      btn.classList.add('active', 'bg-stone-200', 'dark:bg-stone-700', 'text-stone-700', 'dark:text-stone-200')
      btn.classList.remove('bg-stone-100', 'dark:bg-stone-800', 'text-stone-500', 'dark:text-stone-400')

      // Filter events
      events.forEach((event) => {
        const category = event.getAttribute('data-category')
        if (filter === 'all' || category === filter) {
          (event as HTMLElement).style.display = ''
          event.classList.add('animate-in')
        } else {
          (event as HTMLElement).style.display = 'none'
        }
      })
    })
  })
</script>

<style>
  .timeline-event {
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .timeline-event.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  .filter-btn.active {
    font-weight: 600;
  }

  .event-card:hover {
    transform: translateX(4px);
  }

  @media (min-width: 768px) {
    .timeline-event:nth-child(odd) .event-card:hover {
      transform: translateX(-4px);
    }
  }
</style>
