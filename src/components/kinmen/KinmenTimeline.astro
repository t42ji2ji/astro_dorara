---
import InteractiveContainer from '../InteractiveContainer.astro'

interface TimelineEvent {
  year: string
  title: string
  description: string
  location: 'kinmen' | 'taiwan'
  icon: string
}

const events: TimelineEvent[] = [
  {
    year: '1949.05',
    title: 'å°ç£é ’å¸ƒæˆ’åš´ä»¤',
    description: 'å°ç£çœæ”¿åºœä¸»å¸­é™³èª é ’å¸ƒæˆ’åš´ä»¤ï¼Œé–‹å•Ÿäº†é•·é” 38 å¹´çš„æˆ’åš´æ™‚æœŸã€‚',
    location: 'taiwan',
    icon: 'ğŸ‡¹ğŸ‡¼'
  },
  {
    year: '1949.10',
    title: 'å¤å¯§é ­æˆ°å½¹',
    description: 'å…±è»ç™»é™¸é‡‘é–€å¤å¯§é ­ï¼Œç¶“éä¸‰å¤©æ¿€æˆ°å…¨è»è¦†æ²’ï¼Œç¢ºç«‹äº†å…©å²¸åˆ†æ²»çš„å±€é¢ã€‚',
    location: 'kinmen',
    icon: 'âš”ï¸'
  },
  {
    year: '1950',
    title: 'å°ç£å¯¦æ–½åœ°æ–¹è‡ªæ²»',
    description: 'å°ç£é–‹å§‹å¯¦æ–½ç¸£å¸‚é•·èˆ‡ç¸£å¸‚è­°å“¡ç›´æ¥é¸èˆ‰ï¼Œé–‹å•Ÿåœ°æ–¹æ°‘ä¸»è‡ªæ²»ã€‚',
    location: 'taiwan',
    icon: 'ğŸ—³ï¸'
  },
  {
    year: '1956',
    title: 'é‡‘é–€å¯¦æ–½æˆ°åœ°æ”¿å‹™',
    description: 'é‡‘é–€ã€é¦¬ç¥–åŠƒç‚ºæˆ°åœ°æ”¿å‹™å¯¦é©—å€ï¼Œå¯¦æ–½è»æ”¿ä¸€å…ƒåŒ–é ˜å°ï¼Œå±…æ°‘ç”Ÿæ´»å—åš´æ ¼è»äº‹ç®¡åˆ¶ã€‚',
    location: 'kinmen',
    icon: 'ğŸª–'
  },
  {
    year: '1958',
    title: 'å…«äºŒä¸‰ç ²æˆ°',
    description: 'å…±è»å°é‡‘é–€ç™¼å‹•çŒ›çƒˆç ²æ“Šï¼Œ44 å¤©å…§è½ä¸‹ 47 è¬ç™¼ç ²å½ˆã€‚',
    location: 'kinmen',
    icon: 'ğŸ’¥'
  },
  {
    year: '1979',
    title: 'åœæ­¢ã€Œå–®æ‰“é›™ä¸æ‰“ã€',
    description: 'ä¸­ç¾å»ºäº¤å¾Œï¼Œä¸­å…±å®£å¸ƒåœæ­¢å°é‡‘é–€é•·é” 20 å¹´çš„å®£å‚³å½ˆç ²æ“Šã€‚',
    location: 'kinmen',
    icon: 'ğŸ“¢'
  },
  {
    year: '1987',
    title: 'å°ç£è§£é™¤æˆ’åš´',
    description: 'è”£ç¶“åœ‹ç¸½çµ±å®£å¸ƒè§£é™¤æˆ’åš´ï¼Œé–‹æ”¾é»¨ç¦ã€å ±ç¦ï¼Œå°ç£æ°‘ä¸»åŒ–åŠ é€Ÿã€‚ä½†é‡‘é¦¬åœ°å€ä»æŒçºŒæˆ’åš´ã€‚',
    location: 'taiwan',
    icon: 'ğŸ•Šï¸'
  },
  {
    year: '1992',
    title: 'é‡‘é–€è§£é™¤æˆ°åœ°æ”¿å‹™',
    description: 'é‡‘é¦¬åœ°å€çµ‚æ–¼è§£é™¤é•·é” 36 å¹´çš„æˆ°åœ°æ”¿å‹™ï¼Œå›æ­¸æ†²æ”¿é«”åˆ¶ï¼Œæ¯”å°ç£æ™šäº† 5 å¹´ã€‚',
    location: 'kinmen',
    icon: 'ğŸ‰'
  },
    {
    year: '1993',
    title: 'é‡‘é–€é¦–å±†æ°‘é¸ç¸£é•·',
    description: 'é‡‘é–€äººçµ‚æ–¼èƒ½è‡ªå·±é¸ç¸£é•·ã€‚è€Œåœ¨é€™ä¹‹å‰ï¼Œå°ç£å·²ç¶“å¯¦æ–½åœ°æ–¹è‡ªæ²»è¶…é 40 å¹´ã€‚',
    location: 'kinmen',
    icon: 'ğŸ—³ï¸'
  }
]

const locationColors = {
  kinmen: 'bg-orange-500',
  taiwan: 'bg-blue-500' // KMT blue or just a distinct color? Blue represents the ROC/Taiwan connection usually, or maybe Green for Taiwan geography? Let's use Blue/Green/Teal to contrast Orange. Teal is nice.
}
// Actually, let's look at the colors. Kinmen often associated with red/brown/orange (bricks). Taiwan.. maybe Green or Blue. Let's use Teal for Taiwan to be neutral political but distinct.
const locationConfig = {
    kinmen: { color: 'bg-amber-600', label: 'é‡‘é–€æˆ°åœ°' },
    taiwan: { color: 'bg-emerald-600', label: 'å°ç£æœ¬å³¶' }
}

---

<InteractiveContainer
  title="å…©å²¸æ™‚å·®ï¼šè¢«éºå¿˜çš„æˆ°åœ°æ­²æœˆ"
  description="ç•¶å°ç£èµ°å‘æ°‘ä¸»ï¼Œé‡‘é–€ä»è™•æ–¼æˆ°çˆ­ç‹€æ…‹ã€‚ä¸€æ¢æ™‚é–“è»¸ï¼Œçœ‹è¦‹å…©å€‹ä¸–ç•Œçš„è½å·®ã€‚"
>
  <!-- Legend -->
  <div class="flex justify-center gap-6 mb-8">
    <div class="flex items-center gap-2">
        <div class={`w-3 h-3 rounded-full ${locationConfig.taiwan.color}`}></div>
        <span class="text-sm text-stone-600 dark:text-stone-300">å°ç£æœ¬å³¶</span>
    </div>
    <div class="flex items-center gap-2">
        <div class={`w-3 h-3 rounded-full ${locationConfig.kinmen.color}`}></div>
        <span class="text-sm text-stone-600 dark:text-stone-300">é‡‘é–€æˆ°åœ°</span>
    </div>
  </div>

  <!-- Timeline -->
  <div class="relative" id="timeline-container">
    <!-- Vertical line -->
    <div class="absolute left-4 md:left-1/2 top-0 bottom-0 w-0.5 bg-stone-200 dark:bg-stone-700 transform md:-translate-x-1/2"></div>

    <!-- Events -->
    <div class="space-y-8">
      {events.map((event, index) => (
        <div
          class={`timeline-event relative flex flex-col md:flex-row items-start md:items-center gap-4 opacity-0 translate-y-4`}
          data-index={index}
          style={`animation-delay: ${index * 100}ms`}
        >
          <!-- Year badge (center on desktop) -->
          <div class="absolute left-0 md:left-1/2 transform md:-translate-x-1/2 z-10">
            <div class={`w-8 h-8 rounded-full ${locationConfig[event.location].color} flex items-center justify-center text-white text-sm shadow-lg ring-4 ring-white dark:ring-stone-900`}>
              {event.icon}
            </div>
          </div>

          <!-- Content card -->
          <!-- 
            Logic: 
            Taiwan (Left): md:mr-auto md:pr-12 md:text-right md:items-end
            Kinmen (Right): md:ml-auto md:pl-12 md:text-left md:items-start
           -->
          <div class={`
            ml-12 md:ml-0 md:w-[calc(50%-0rem)] flex flex-col
            ${event.location === 'taiwan' 
                ? 'md:mr-auto md:pr-12 md:items-end md:text-right' 
                : 'md:ml-auto md:pl-12 md:items-start md:text-left'}
          `}>
             <span class={`inline-block mb-2 text-xs px-2 py-0.5 rounded text-white ${locationConfig[event.location].color}`}>
                {event.year}
            </span>
            <div class={`
                event-card bg-white dark:bg-stone-800 rounded-lg p-4 shadow-md border-l-4 
                ${event.location === 'taiwan' ? 'border-r-4 border-l-0 border-emerald-500/50' : 'border-amber-500/50'} 
                hover:shadow-lg transition-all cursor-pointer group w-full md:w-auto
            `}>
              <h4 class="font-bold text-stone-800 dark:text-stone-100 mb-1">
                {event.title}
              </h4>
              <p class="text-sm text-stone-600 dark:text-stone-400 leading-relaxed">
                {event.description}
              </p>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</InteractiveContainer>

<script>
  // Intersection Observer for scroll animations
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-in')
          entry.target.classList.remove('opacity-0', 'translate-y-4')
        }
      })
    },
    { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
  )

  document.querySelectorAll('.timeline-event').forEach((el) => {
    observer.observe(el)
  })
</script>

<style>
  .timeline-event {
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .timeline-event.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  .event-card:hover {
    transform: translateY(-2px);
  }
</style>
