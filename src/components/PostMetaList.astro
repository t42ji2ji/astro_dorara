---
import { Image } from 'astro:assets'
import type { Post } from '~/types'
import { formatDate, getPostDescription } from '~/utils'
import PostPreviewCard from './PostPreviewCard.astro'

interface Props {
  post: Post
}

const { post } = Astro.props

const categoryList = post.data.categories ?? []
const isDraft = post.data.draft === true
const isEssay = categoryList.some((cat) => cat.toLowerCase() === 'essays')
const isNotes = categoryList.some((cat) => cat.toLowerCase() === 'notes')
const banner = post.data.banner
---

<header class="post-item-wrapper">
  <a class="flex gap-4 not-prose not-underline-hover post-link" href={`/posts/${post.id}/`}>
    <div class="flex flex-col gap-1 flex-1 min-w-0 md:gap-2">
      <h1 class="post-title">
        {post.data.title}
      </h1>
      <p class="mt-1 mb-0 text-stone-500 dark:text-stone-400">{getPostDescription(post)}</p>
      <div class="flex gap-2 items-center text-sm">
        {isDraft && <span class="text-amber-500 dark:text-amber-400">[草稿]</span>}
        {isEssay && <span>[Essay]</span>}
        {isNotes && <span class="text-stone-500">[筆記]</span>}
        <span class="text-3 text-gray-500">
          <time>{formatDate(post.data.modDate ?? post.data.pubDate)}</time>
        </span>
      </div>
    </div>
    <!-- 手機版顯示縮圖，桌面版隱藏（因為 hover 卡片有大圖） -->
    <div class="post-thumbnail md:hidden">
      {
        banner ? (
          <Image src={banner} alt={post.data.title} class="shrink-0 rounded w-[80px] h-[60px]" />
        ) : (
          <div class="shrink-0 w-[80px] h-[60px]" />
        )
      }
    </div>
  </a>

  <!-- 桌面版 hover 預覽卡片 -->
  <PostPreviewCard post={post} />
</header>

<style>
  .post-item-wrapper {
    position: relative;
  }
</style>
